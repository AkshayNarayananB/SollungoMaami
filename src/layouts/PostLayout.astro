---
import Main from "../layouts/MainLayout.astro";
import Markdown from "../components/Markdown.astro";
import CopyRight from "../components/misc/CopyRight.astro";

interface Props {
  title?: string;
  subTitle?: string;
  bannerImage?: string;
  published?: Date;
  license?: { name: string; url?: string };
  image?: string;
  author?: string;
  sourceLink?: string;
}

const {
  title,
  subTitle,
  bannerImage,
  published,
  license,
  author,
  sourceLink,
  image,
} = Astro.props;

// Use URL path as blogId (slug)
const blogId = Astro.url.pathname.replace(/^\/|\/$/g, "");
---

<Main title={title} subTitle={subTitle}>
  <div class="article-wrapper">
    <div class="article">
      <Markdown>
        <slot />
      </Markdown>

      {published && title && (
        <CopyRight
          title={title}
          published={published}
          license={license}
          author={author}
          sourceLink={sourceLink}
        />
      )}
    </div>
  </div>
  <!-- Facebook SDK (include once per site) -->
<div id="fb-root"></div>
<script>
  // Load Facebook SDK if not already loaded
  if (!window.fbAsyncInit) {
    window.fbAsyncInit = function() {
      FB.init({ xfbml: true, version: 'v23.0' });
      FB.XFBML.parse(); // Initial parse
    };
    const script = document.createElement('script');
    script.async = true;
    script.defer = true;
    script.crossOrigin = 'anonymous';
    script.src = 'https://connect.facebook.net/en_GB/sdk.js';
    document.body.appendChild(script);
  } else if (window.FB) {
    // Re-parse Facebook comments every time this script runs
    window.FB.XFBML.parse();
  }
</script>
</Main>

<style>
.article-wrapper {
  @apply mx-3 rounded-2xl bg-[var(--card-color)] px-5 py-6 lg:mx-0 lg:px-10 lg:py-9;
}
.article {
  @apply flex flex-col;
  font-size: var(--primary-font);
}
/* Disqus override to prevent parseColor errors */
#disqus_thread,
#disqus_thread * {
  color: #000 !important;
  background-color: #fff !important;
  border-color: #ccc !important;
}
</style>
