---
// disqus.astro
const { slug } = Astro.props; // pass post slug from parent
const embedJsPath = "https://sollungomaami.disqus.com/embed.js"; // replace with your actual embed.js path
---
<div id="disqus_thread"></div>

<script is:inline>
if (!window.DisqusWidget) {
    window.DisqusWidget = {
        overwriteGlobalSelectors: function () {
            window.$disqus = document.querySelector('#disqus_thread')
        },
        init: function () {
            this.overwriteGlobalSelectors()
            this.addListeners()
            this.initDisqus()
        },
        addListeners: function () {
            // After page transitions (Swup / Astro view transitions)
            document.addEventListener('astro:after-swap', () => {
                this.overwriteGlobalSelectors()
                this.initDisqus()
            })
        },
        initDisqus: () => {
            if (!window.$disqus) return

            if (window.DISQUS) {
                window.DISQUS.reset({
                    reload: true,
                    config: function () {
                        this.page.identifier = "{slug}";
                        this.page.url = "https://www.sollungomaami.com/posts/{slug}";
                    }
                })
                return
            }

            (function () {
                const d = document, s = d.createElement('script');
                s.src = "{embedJsPath}";
                s.setAttribute('data-timestamp', String(+new Date()));
                (d.head || d.body).appendChild(s);
            })();
        }
    }

    window.DisqusWidget.init()
}
</script>

<noscript>
Please enable JavaScript to view the 
<a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
